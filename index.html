<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Builder Pro v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Times+New+Roman&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }

        @media print {
            .no-print { display: none !important; }
            .page-break { break-before: page; }
            body { background: white; }
            #test-preview { border: none; box-shadow: none; width: 100%; padding: 0; margin: 0; }
        }
        
        #test-preview { font-family: 'Times New Roman', serif; }
        .dotted-line { border-bottom: 1px dotted #64748b; height: 1.8em; width: 100%; display: block; }
        
        /* Hi·ªáu ·ª©ng m∆∞·ª£t m√† cho Menu */
        .dropdown-animate { animation: slideUp 0.2s ease-out; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <aside class="w-full md:w-96 bg-slate-900 text-slate-300 p-6 shadow-2xl overflow-y-auto no-print h-screen sticky top-0 flex flex-col">
        <div class="mb-8">
            <h1 class="text-2xl font-bold text-white flex items-center gap-3">
                <span class="bg-blue-600 p-2 rounded-lg text-white">‚ö°</span>
                Exam Builder <span class="text-blue-500">PRO</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1 uppercase tracking-widest font-semibold">H·ªá th·ªëng t·∫°o ƒë·ªÅ th√¥ng minh</p>
        </div>
        
        <div class="space-y-5 flex-1">
            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                <h2 class="text-blue-400 text-[10px] font-bold uppercase mb-3 tracking-tighter">I. C·∫•u tr√∫c h√†nh ch√≠nh</h2>
                <div class="space-y-3">
                    <input type="text" id="school-name" placeholder="T√™n tr∆∞·ªùng h·ªçc..." class="w-full bg-slate-900 border border-slate-700 p-2.5 rounded-lg text-sm text-white placeholder-slate-500 focus:border-blue-500 outline-none transition-all">
                    <input type="text" id="school-year" placeholder="NƒÉm h·ªçc (2025 - 2026)..." class="w-full bg-slate-900 border border-slate-700 p-2.5 rounded-lg text-sm text-white placeholder-slate-500 focus:border-blue-500 outline-none transition-all">
                    <div class="flex items-center gap-3 bg-slate-900 p-2 rounded-lg border border-slate-700">
                        <span class="text-xs font-medium">Th·ªùi gian (ph√∫t):</span>
                        <input type="number" id="test-duration" value="60" class="flex-1 bg-transparent text-blue-400 font-bold outline-none text-right pr-2">
                    </div>
                </div>
            </div>

            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                <h2 class="text-blue-400 text-[10px] font-bold uppercase mb-3 tracking-tighter">II. Ph·∫°m vi ki·∫øn th·ª©c</h2>
                <div class="grid grid-cols-3 gap-2" id="unit-selector">
                    <label class="flex items-center gap-2 bg-slate-900 p-2 rounded cursor-pointer hover:bg-slate-700 transition">
                        <input type="checkbox" class="unit-cb w-4 h-4 accent-blue-500" value="1" checked>
                        <span class="text-xs">Unit 1</span>
                    </label>
                    <label class="flex items-center gap-2 bg-slate-900 p-2 rounded cursor-pointer hover:bg-slate-700 transition">
                        <input type="checkbox" class="unit-cb w-4 h-4 accent-blue-500" value="2" checked>
                        <span class="text-xs">Unit 2</span>
                    </label>
                    <label class="flex items-center gap-2 bg-slate-900 p-2 rounded cursor-pointer hover:bg-slate-700 transition">
                        <input type="checkbox" class="unit-cb w-4 h-4 accent-blue-500" value="3" checked>
                        <span class="text-xs">Unit 3</span>
                    </label>
                </div>
            </div>

            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                <h2 class="text-blue-400 text-[10px] font-bold uppercase mb-3 tracking-tighter">III. Ti√™u ƒë·ªÅ c√°c ph·∫ßn</h2>
                <div class="space-y-2">
                    <input type="text" id="p1-title" placeholder="Ph·∫ßn I: MCQ" class="w-full bg-slate-900 border border-slate-700 p-2 rounded text-[11px] text-slate-300 outline-none">
                    <input type="text" id="p2-title" placeholder="Ph·∫ßn II: READING" class="w-full bg-slate-900 border border-slate-700 p-2 rounded text-[11px] text-slate-300 outline-none">
                    <input type="text" id="p3-title" placeholder="Ph·∫ßn III: WRITING" class="w-full bg-slate-900 border border-slate-700 p-2 rounded text-[11px] text-slate-300 outline-none">
                </div>
            </div>
        </div>

        <div class="mt-8 space-y-3 pt-6 border-t border-slate-800">
            <button onclick="generateTest()" class="w-full bg-blue-600 text-white font-bold py-3.5 rounded-xl hover:bg-blue-500 transition shadow-lg shadow-blue-900/20 active:scale-95 flex items-center justify-center gap-2 uppercase text-xs tracking-widest">
                T·∫°o ƒë·ªÅ ngay üé≤
            </button>
            
            <div class="relative inline-block text-left w-full" id="dropdownContainer">
                <button id="dropdownBtn" class="w-full bg-white text-slate-900 font-bold py-3.5 rounded-xl hover:bg-slate-100 transition flex justify-center items-center gap-2 shadow-xl active:scale-95 uppercase text-xs tracking-widest">
                    Xu·∫•t file üì§
                </button>
                <div id="dropdownMenu" class="hidden dropdown-animate absolute left-0 bottom-full mb-3 w-full bg-white border rounded-xl shadow-2xl z-50 overflow-hidden">
                    <button onclick="window.print()" class="block w-full text-left px-5 py-4 hover:bg-blue-50 border-b border-slate-100 text-sm font-semibold text-slate-700 transition">
                        üñ®Ô∏è In ƒë·ªÅ / Xu·∫•t PDF
                    </button>
                    <button onclick="exportToWord()" class="block w-full text-left px-5 py-4 hover:bg-blue-50 text-sm font-semibold text-slate-700 transition">
                        üìÑ T·∫£i file Word (.doc)
                    </button>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 p-6 md:p-12 overflow-y-auto flex justify-center">
        <div id="test-preview" class="bg-white p-12 md:p-20 shadow-[0_20px_50px_rgba(0,0,0,0.1)] w-full max-w-[210mm] min-h-[297mm] rounded-sm transition-all">
            <div class="flex flex-col items-center justify-center h-full text-slate-300 space-y-4 py-60 border-2 border-dashed border-slate-100 rounded-2xl">
                <span class="text-7xl animate-bounce">üìã</span>
                <p class="text-lg font-medium text-slate-400 italic">Giao di·ªán s·∫µn s√†ng. Vui l√≤ng nh·∫•n "T·∫°o ƒë·ªÅ ngay".</p>
            </div>
        </div>
    </main>

    <script>
        // NG√ÇN H√ÄNG C√ÇU H·ªéI (H·ª£p nh·∫•t d·ªØ li·ªáu Unit 1, 2, 3)
        const questionBank = [
            { unit: 1, type: 'mcq', text: 'I adore _______ with my friends in the park.', options: ['hanging out', 'to hang out', 'hang out', 'hung out'], answer: 'A' },
            { unit: 1, type: 'mcq', text: 'Which word has a different sound?', options: ['cook', 'food', 'book', 'foot'], answer: 'B' },
            { unit: 2, type: 'mcq', text: 'Life in the countryside is _______ than in the city.', options: ['more peaceful', 'peacefuler', 'peacefully', 'peaceful'], answer: 'A' },
            { unit: 3, type: 'mcq', text: 'I was tired; _______, I finished my homework.', options: ['however', 'therefore', 'otherwise', 'so'], answer: 'A' },
            { unit: 1, type: 'reading', 
              passage: 'Leisure activities are essential for a balanced life. While some people enjoy outdoor sports like football or cycling, others find relaxation in quiet hobbies such as reading or gardening.', 
              questions: [
                  { q: 'Why are leisure activities important?', a: 'They are essential for a balanced life.' }
              ] 
            },
            { unit: 1, type: 'writing', text: 'I am fond of making origami. (Rewrite: I enjoy...)', answer: 'I enjoy making origami.' }
        ];

        // LOGIC UI
        const btn = document.getElementById('dropdownBtn');
        const menu = document.getElementById('dropdownMenu');
        const container = document.getElementById('dropdownContainer');
        
        btn.onclick = (e) => { e.stopPropagation(); menu.classList.toggle('hidden'); };
        window.onclick = (e) => { if (!container.contains(e.target)) menu.classList.add('hidden'); };

        function getGridClass(options) {
            const maxLen = Math.max(...options.map(opt => opt.length));
            return maxLen <= 12 ? 'grid-cols-4' : (maxLen <= 25 ? 'grid-cols-2' : 'grid-cols-1');
        }

        function generateTest() {
            const school = document.getElementById('school-name').value || "TR∆Ø·ªúNG THCS .....................";
            const year = document.getElementById('school-year').value || "2025 - 2026";
            const duration = document.getElementById('test-duration').value || "60";
            
            const selectedUnits = Array.from(document.querySelectorAll('.unit-cb:checked')).map(cb => parseInt(cb.value));
            let filtered = questionBank.filter(q => selectedUnits.includes(q.unit)).sort(() => Math.random() - 0.5);

            const mcqs = filtered.filter(q => q.type === 'mcq').slice(0, 30);
            const reading = filtered.filter(q => q.type === 'reading').slice(0, 1);
            const writing = filtered.filter(q => q.type === 'writing').slice(0, 5);

            document.getElementById('test-preview').innerHTML = `
                <div class="text-center mb-10">
                    <h2 class="font-bold text-lg uppercase">${school}</h2>
                    <p class="font-bold text-sm">NƒÉm h·ªçc: ${year}</p>
                    <div class="w-32 h-0.5 bg-black mx-auto my-3"></div>
                    <h1 class="text-2xl font-bold uppercase mt-4">ƒê·ªÄ KI·ªÇM TRA GI·ªÆA K·ª≤ I</h1>
                    <p class="text-sm">M√¥n: Ti·∫øng Anh 8 ‚Äî Th·ªùi gian: ${duration} ph√∫t</p>
                </div>
                
                <div class="mb-10 italic text-[14px] border-b border-slate-200 pb-3">
                    H·ªç v√† t√™n: ............................................................ L·ªõp: ...........
                </div>

                <div class="space-y-12">
                    <section>
                        <h3 class="font-bold mb-4 border-b-2 border-black pb-1 uppercase">${document.getElementById('p1-title').value || "PART I. MULTIPLE CHOICE"}</h3>
                        <div class="space-y-4">
                            ${mcqs.map((q, i) => `
                                <div class="text-[15px]">
                                    <p><strong>Question ${i+1}:</strong> ${q.text}</p>
                                    <div class="grid ${getGridClass(q.options)} mt-2 pl-4">
                                        ${q.options.map((opt, idx) => `<span>${String.fromCharCode(65+idx)}. ${opt}</span>`).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>

                    <section>
                        <h3 class="font-bold mb-4 border-b-2 border-black pb-1 uppercase">${document.getElementById('p2-title').value || "PART II. READING"}</h3>
                        ${reading.map(r => `
                            <p class="italic mb-6 text-justify text-[15px] leading-relaxed">${r.passage}</p>
                            ${r.questions.map((q, i) => `
                                <div class="mb-6">
                                    <p class="text-[15px]"><strong>${i+1}.</strong> ${q.q}</p>
                                    <div class="dotted-line mt-3"></div>
                                </div>
                            `).join('')}
                        `).join('')}
                    </section>

                    <section>
                        <h3 class="font-bold mb-4 border-b-2 border-black pb-1 uppercase">${document.getElementById('p3-title').value || "PART III. WRITING"}</h3>
                        ${writing.map((q, i) => `
                            <div class="mb-8">
                                <p class="text-[15px]"><strong>${i+1}.</strong> ${q.text}</p>
                                <div class="dotted-line mt-5"></div>
                            </div>
                        `).join('')}
                    </section>
                </div>
            `;
        }

        function exportToWord() {
            const school = document.getElementById('school-name').value || "De_Thi";
            const fileName = `${school}.doc`.replace(/\s+/g, '_');
            let previewClone = document.getElementById('test-preview').cloneNode(true);
            previewClone.querySelectorAll('.dotted-line').forEach(line => line.innerHTML = "..................................................................................................................................");
            
            const header = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><style>body{font-family:'Times New Roman';} .grid span{display:inline-block; width:24%;}</style></head><body>`;
            const blob = new Blob(['\ufeff', header + previewClone.innerHTML + "</body></html>"], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob); link.download = fileName; link.click();
        }
    </script>
</body>
</html>